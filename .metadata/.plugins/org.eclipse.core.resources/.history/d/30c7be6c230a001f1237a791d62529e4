<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta
	http-equiv="X-UA-Compatible"
	content="IE=edge"
>
<meta
	name="viewport"
	content="width=device-width, initial-scale=1.0"
>
<title>Shopmmt - Quản lý người dùng</title>
<link
	rel="stylesheet"
	type="text/css"
	th:href="@{/webjars/bootstrap/css/bootstrap.min.css}"
>
<link
	rel="stylesheet"
	type="text/css"
	th:href="@{/fontawesome/all.css}"
>
<link
	rel="stylesheet"
	type="text/css"
	th:href="@{/css/style.css}"
>
<script
	type="text/javascript"
	th:src="@{/webjars/jquery/jquery.min.js}"
></script>
<script
	type="text/javascript"
	th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"
></script>
</head>
<body>
	<div class="container-fluid mt-4">
		<div th:insert="~{fragments/header :: header}"></div>

		<h2>Quản lý người dùng</h2>

		<div class="row mt-1">
			<form
				class="col-sm-8 d-flex"
				th:action=@{/users/page/1}
			>
				<input
					type="hidden"
					name="sortField"
					th:value="${sortField}"
				/>
				<input
					type="hidden"
					name="sortDir"
					th:value="${sortDir}"
				/>
				<input
					name="keyword"
					th:value="${keyword}"
					class="form-control mr-2 w-75"
					type="search"
					placeholder="Từ khóa..."
					aria-label="Search"
				/>
				&nbsp;
				<button
					class="btn btn-outline-success d-block ml-2 mr-2"
					type="submit"
					id="btnSearch"
					title="Tìm kiếm"
				>
					<i class="fa-solid fa-magnifying-glass"></i>
				</button>
				&nbsp;
				<button
					type="button"
					class="btn btn-outline-secondary"
					title="Xóa"
					onclick="clearFilter()"
				>
					<i class="fa-solid fa-broom"></i>
				</button>
			</form>
			<div class="col-sm-4 d-flex justify-content-end mt-1">
				<a
					th:href="@{/users/new}"
					class="fa-solid fa-user-plus fa-2x"
					title="Thêm mới người dùng"
				></a>
				&nbsp; &nbsp;
				<a
					th:href="@{/users/export/csv}"
					class="fa-solid fa-file-csv fa-2x icon-silver"
					title="Xuất file CSV"
				> </a>
				&nbsp; &nbsp;
				<a
					th:href="@{/users/export/excel}"
					class="fa-solid fa-file-excel fa-2x icon-green"
					title="Xuất file Excel"
				> </a>
				&nbsp; &nbsp;
				<a
					th:href="@{/users/export/pdf}"
					class="fa-solid fa-file-pdf fa-2x d-inline-block icon-yellow"
					title="Xuất file PDF"
				> </a>
			</div>
		</div>

		<div
			th:if="${message != null}"
			class="alert alert-success text-center"
		>[[${message}]]</div>
		<div
			th:if="${error != null}"
			class="alert alert-danger text-center"
		>[[${error}]]</div>

		<div class="mt-2 full-details">
			<table
				class="table table-responsive-xl table-bordered table-striped table-hover"
			>
				<thead class="table-dark">
					<tr class="text-center">
						<th
							th:replace="~{fragments/column_link :: column_link('id', 'ID')}"
						/>
						<th>Hình ảnh</th>
						<th
							th:replace="~{fragments/column_link :: column_link('email', 'E-mail')}"
						/>
						<th
							th:replace="~{fragments/column_link :: column_link('lastName', 'Họ đệm')}"
						/>
						<th
							th:replace="~{fragments/column_link :: column_link('firstName', 'Tên')}"
						/>
						<th>Vai trò</th>
						<th
							th:replace="~{fragments/column_link :: column_link('enabled', 'Khả dụng')}"
						/>
						<th>Hành động</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="user : ${listUsers}">
						<td class="text-center">[[${user.id}]]</td>
						<td class="d-flex justify-content-center align-items-center">
							<span
								th:if="${user.photos == null}"
								class="fa-solid fa-user"
							></span>
							<img
								width="80px"
								th:if="${user.photos != null}"
								th:src="@{${user.photosImagePath}}"
							/>
						</td>
						<td>[[${user.email}]]</td>
						<td>[[${user.lastName}]]</td>
						<td>[[${user.firstName}]]</td>
						<td>[[${user.roles}]]</td>
						<td class="text-center">
							<div>
								<a
									th:if="${user.enabled == true}"
									data-bs-toggle="tooltip"
									data-bs-placement="top"
									title="Khóa"
									class="fa-solid fa-toggle-on fa-xl icon-blue"
									th:href="@{'/users/' + ${user.id} + '/enabled/false'}"
								></a>
								<a
									th:if="${user.enabled == false}"
									data-bs-toggle="tooltip"
									data-bs-placement="top"
									title="Mở khóa"
									class="fa-solid fa-toggle-off fa-xl icon-silver"
									th:href="@{'/users/' + ${user.id} + '/enabled/true'}"
								></a>
							</div>

						</td>
						<td class="text-center">
							<div>
								<a
									th:href="@{'/users/showEdit/' + ${user.id}}"
									class="fa-solid fa-pen-to-square fa-xl icon-green"
									data-bs-toggle="tooltip"
									data-bs-placement="top"
									title="Chỉnh sửa"
								> </a>
								&nbsp;
								<a
									th:href="@{'/users/delete/' + ${user.id}}"
									th:userId="${user.id}"
									class="fa-solid fa-trash fa-xl link-delete icon-red"
									data-bs-toggle="tooltip"
									data-bs-placement="top"
									title="Xóa"
								> </a>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="less-details">
			<div
				th:each="user : ${listUsers}"
				class="row m-1"
			>
				<div class="col-3">
					<span
						th:if="${user.photos == null}"
						class="fa-solid fa-user"
					></span>
					<img
						width="80px"
						th:if="${user.photos != null}"
						th:src="@{${user.photosImagePath}}"
					/>
				</div>
				<div class="col-9">
					<div>[[${user.fullName}]]</div>
					<div>[[${user.roles}]]</div>
					<div class="mt-1">
						<a
							th:if="${user.enabled == true}"
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Khóa"
							class="fa-solid fa-toggle-on fa-xl icon-blue"
							th:href="@{'/users/' + ${user.id} + '/enabled/false'}"
						></a>
						<a
							th:if="${user.enabled == false}"
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Mở khóa"
							class="fa-solid fa-toggle-off fa-xl icon-silver"
							th:href="@{'/users/' + ${user.id} + '/enabled/true'}"
						></a>
						&nbsp;
						<a
							th:href="@{'/users/showEdit/' + ${user.id}}"
							class="fa-solid fa-pen-to-square fa-xl icon-green"
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Chỉnh sửa"
						> </a>
						&nbsp;
						<a
							th:href="@{'/users/delete/' + ${user.id}}"
							th:userId="${user.id}"
							class="fa-solid fa-trash fa-xl link-delete icon-red"
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="Xóa"
						> </a>
					</div>
				</div>
			</div>
		</div>

		<div th:if="${currentPage <= totalPages}">
			<span>
				Trang
				<b>[[${currentPage}]]</b>
				của [[${totalPages}]]
			</span>
		</div>
		<div th:unless="${currentPage <= totalPages}">
			<span>
				<b>Danh sách rỗng</b>
			</span>
		</div>

		<!-- Pagination -->
		<div th:if="${totalItems > 0}">
			<nav aria-label="Page navigation example">
				<ul class="pagination justify-content-center flex-wrap">
					<li
						th:class="${currentPage > 1 ? 'page-item' : 'page-item disabled'}"
					>
						<a th:replace="~{fragments/page_link :: page_link(1, 'Đầu')}"></a>
					</li>
					<li
						th:class="${currentPage > 1 ? 'page-item' : 'page-item disabled'}"
					>
						<a
							th:replace="~{fragments/page_link :: page_link(${currentPage - 1}, 'Trước')}"
						></a>
					</li>
					<li
						th:class="${currentPage != i ? 'page-item' : 'page-item active'}"
						th:each="i : ${#numbers.sequence(1, totalPages)}"
					>
						<a th:replace="~{fragments/page_link :: page_link(${i}, ${i})}"></a>
					</li>
					<li
						th:class="${currentPage < totalPages ? 'page-item' : 'page-item disabled'}"
					>
						<a
							th:replace="~{fragments/page_link :: page_link(${currentPage + 1}, 'Tiếp')}"
						></a>
					</li>
					<li
						th:class="${currentPage < totalPages ? 'page-item' : 'page-item disabled'}"
					>
						<a
							th:replace="~{fragments/page_link :: page_link(${totalPages}, 'Cuối')}"
						></a>
					</li>
				</ul>
			</nav>
		</div>
		<!-- END Pagination  -->

		<!-- Modal  -->
		<div
			class="modal fade text-center"
			id="confirmModal"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">Xác nhận xóa</h4>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<span id="confirmText"></span>
					</div>
					<div class="modal-footer">
						<a
							href=""
							class="btn btn-success"
							id="confirmButton"
						>Xác nhận</a>
						<button
							type="button"
							class="btn btn-danger"
							data-bs-dismiss="modal"
						>Hủy</button>
					</div>
				</div>
			</div>
		</div>
		<!-- END Modal  -->

		<div class="text-center">
			<p>Shopmmt Admin - Copyright &copy; Shopmmt</p>
		</div>
	</div>

	<script type="text/javascript">
		$(function() {
			$('[data-toggle="tooltip"]').tooltip();
		});
		$(document).ready(
				function() {
					$(".link-delete").on(
							"click",
							function(e) {
								e.preventDefault();
								link = $(this);
								userId = link.attr("userId");
								$("#confirmButton").attr("href",
										link.attr("href"));
								$("#confirmText").text(
										"Bạn chắc chắn muốn xóa người dùng ID "
												+ userId + "?");
								$("#confirmModal").modal("show");
							});
				});

		function clearFilter() {
			window.location = "[[@{/users}]]";
		}
	</script>

</body>
</html>